<!DOCTYPE html>
<html>
<head>
    <title>üé• –ü—Ä–æ—Å—Ç–æ–π –≤–∏–¥–µ–æ—á–∞—Ç</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        input, button { padding: 10px; margin: 5px; }
        video { width: 300px; border: 2px solid #333; }
    </style>
</head>
<body>
    <h1>üé• –ü—Ä–æ—Å—Ç–æ–π –≤–∏–¥–µ–æ—á–∞—Ç</h1>
    
    <input type="text" id="username" placeholder="–ò–º—è" value="User">
    <input type="text" id="roomId" placeholder="–ö–æ–º–Ω–∞—Ç–∞" value="room1">
    <button onclick="connectToRoom()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
    <button onclick="startVideo()" id="videoBtn" disabled>–í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
    
    <hr>
    <video id="localVideo" autoplay muted playsinline></video>
    <div id="remoteVideo"></div>
    
    <script>
    // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—á–∏–π –∫–æ–¥
    let ws, localStream;
    
    async function connectToRoom() {
        console.log('–ö–Ω–æ–ø–∫–∞ –Ω–∞–∂–∞—Ç–∞!');
        
        const username = document.getElementById('username').value;
        const roomId = document.getElementById('roomId').value;
        const clientId = 'user_' + Date.now();
        
        alert(`–ü–æ–¥–∫–ª—é—á–∞—é—Å—å –∫–∞–∫ ${username} –≤ –∫–æ–º–Ω–∞—Ç—É ${roomId}`);
        
        // –°–æ–∑–¥–∞–µ–º WebSocket
        ws = new WebSocket(`ws://${window.location.hostname}:8000/ws/${clientId}`);
        
        ws.onopen = () => {
            console.log('‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω');
            ws.send(JSON.stringify({
                type: 'join',
                room: roomId,
                username: username
            }));
            
            document.getElementById('videoBtn').disabled = false;
        };
        
        ws.onmessage = (event) => {
            console.log('–°–µ—Ä–≤–µ—Ä:', event.data);
        };
    }
    
    async function startVideo() {
        try {
            localStream = await navigator.mediaDevices.getUserMedia({
                video: true,
                audio: true
            });
            document.getElementById('localVideo').srcObject = localStream;
            alert('‚úÖ –ö–∞–º–µ—Ä–∞ –≤–∫–ª—é—á–µ–Ω–∞!');
        } catch (error) {
            alert('‚ùå –û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã: ' + error.message);
        }
    }
    
    console.log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    </script>
</body>
</html>
        function updateUI() {
            // Enable chat input on Enter
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Auto-select first camera/microphone if available
            setTimeout(() => {
                const cameraSelect = document.getElementById('cameraSelect');
                const audioSelect = document.getElementById('audioSelect');
                
                if (cameraSelect.options.length > 1 && !cameraSelect.value) {
                    cameraSelect.selectedIndex = 1;
                }
                
                if (audioSelect.options.length > 1 && !audioSelect.value) {
                    audioSelect.selectedIndex = 1;
                }
            }, 1000);
        }
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (ws) {
                ws.close();
            }
            stopVideo();
        });
    </script>
</body>
</html>